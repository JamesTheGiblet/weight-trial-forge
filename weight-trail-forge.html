<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrialForge | Weight Management Retention</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        /* CORE STYLES FROM ORIGINAL FORGE CONCEPT */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        :root {
            --clinical-blue: #00838f; /* Teal for metabolic health */
            --clinical-light: #e0f7fa;
            --retention-green: #2e7d32;
            --risk-yellow: #f9a825;
            --dropout-red: #c62828;
            --pharma-purple: #6a1b9a;
            --gray-50: #fafafa; --gray-100: #f5f5f5; --gray-200: #eeeeee; --gray-700: #616161; --gray-900: #212121;
        }
        
        body { background: linear-gradient(135deg, #e0f2f1 0%, #f5f5f5 100%); color: var(--gray-900); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        
        /* HEADER */
        .clinical-header {
            background: linear-gradient(135deg, var(--clinical-blue) 0%, #006064 100%);
            color: white; padding: 40px 0 60px; position: relative; overflow: hidden; margin-bottom: -20px;
        }
        .clinical-header::before { content: '⚖️'; position: absolute; right: 50px; top: 50%; transform: translateY(-50%); font-size: 6rem; opacity: 0.1; }
        .header-content { position: relative; z-index: 2; max-width: 1000px; }
        .demo-badge { display: inline-block; background: rgba(255,255,255,0.2); color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.3); }
        h1 { font-size: 2.8rem; font-weight: 700; margin-bottom: 15px; line-height: 1.1; }
        .header-subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px; max-width: 800px; }
        
        /* DISCLAIMER */
        .disclaimer-box { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 25px; margin-top: 30px; border-left: 4px solid #a7ffeb; }
        .disclaimer-box h4 { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }

        /* OVERVIEW GRID */
        .trial-overview { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 50px 0; }
        .trial-stat-card { background: white; border-radius: 12px; padding: 30px; text-align: center; border-top: 5px solid; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: transform 0.3s ease; }
        .trial-stat-card:hover { transform: translateY(-5px); }
        .stat-icon { width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; margin: 0 auto 20px; }
        .enrolled-icon { background: var(--clinical-blue); }
        .active-icon { background: var(--retention-green); }
        .risk-icon { background: var(--risk-yellow); }
        .dropout-icon { background: var(--dropout-red); }
        .stat-value { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; color: var(--gray-900); }
        .stat-label { font-size: 1rem; color: var(--gray-700); }

        /* MAIN LAYOUT */
        .main-grid { display: grid; grid-template-columns: 1fr 1.1fr; gap: 40px; margin: 40px 0; }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
        
        .card { background: white; border-radius: 15px; padding: 35px; margin-bottom: 30px; border: 1px solid var(--gray-200); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .card-title { font-size: 1.6rem; font-weight: 700; margin-bottom: 30px; color: var(--clinical-blue); display: flex; align-items: center; gap: 15px; padding-bottom: 20px; border-bottom: 3px solid var(--gray-100); }
        .card-title i { color: var(--clinical-blue); }

        /* INPUT SECTIONS */
        .patient-section { margin-bottom: 30px; padding: 25px; border-radius: 12px; background: var(--gray-50); border-left: 5px solid; }
        .engagement-section { border-left-color: var(--retention-green); }
        .protocol-section { border-left-color: var(--clinical-blue); }
        .demographic-section { border-left-color: var(--pharma-purple); }
        
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .section-title { font-size: 1.3rem; font-weight: 700; color: var(--gray-900); display: flex; align-items: center; gap: 12px; }
        .section-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.1rem; }
        .engagement-icon { background: var(--retention-green); }
        .protocol-icon { background: var(--clinical-blue); }
        .demographic-icon { background: var(--pharma-purple); }
        
        .risk-score { font-size: 1.8rem; font-weight: 800; color: var(--gray-900); }
        .risk-label { font-size: 0.9rem; color: var(--gray-700); }
        
        .input-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; font-weight: 600; margin-bottom: 10px; color: var(--gray-900); font-size: 1.05rem; }
        select { width: 100%; padding: 15px; border: 2px solid var(--gray-200); border-radius: 8px; font-size: 1rem; background: white; transition: border-color 0.3s ease; }
        select:focus { outline: none; border-color: var(--clinical-blue); }
        .input-hint { font-size: 0.85rem; color: var(--gray-700); margin-top: 5px; font-style: italic; }

        /* INTERVENTIONS */
        .interventions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 25px; }
        .intervention-card { background: white; border: 2px solid var(--gray-200); border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .intervention-card:hover { border-color: var(--clinical-blue); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .intervention-card.selected { border-color: var(--retention-green); background-color: rgba(46, 125, 50, 0.05); }
        .intervention-check { position: absolute; top: 15px; right: 15px; width: 24px; height: 24px; border-radius: 50%; background: var(--gray-200); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; }
        .intervention-card.selected .intervention-check { background: var(--retention-green); }
        .intervention-title { font-weight: 700; margin-bottom: 10px; font-size: 1.2rem; color: var(--gray-900); }
        .intervention-description { font-size: 0.95rem; color: var(--gray-700); margin-bottom: 15px; line-height: 1.5; }
        .intervention-impact { display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--gray-200); }
        .impact-value { font-weight: 700; color: var(--retention-green); font-size: 1.1rem; }
        .cost-value { color: var(--clinical-blue); }

        /* RESULTS AREA */
        .retention-card { background: linear-gradient(135deg, var(--clinical-blue) 0%, #006064 100%); color: white; border-radius: 15px; padding: 40px; }
        .retention-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 35px; flex-wrap: wrap; gap: 20px; }
        .current-retention { font-size: 3.5rem; font-weight: 800; line-height: 1; margin-bottom: 10px; }
        .target-badge { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 20px; font-weight: 600; backdrop-filter: blur(10px); }
        .comparison-item { display: flex; align-items: center; justify-content: space-between; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .comparison-item:last-child { border-bottom: none; }
        .comparison-badge { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; margin-left: 10px; }
        .badge-low { background: var(--retention-green); color: white; }
        .badge-medium { background: var(--risk-yellow); color: white; }
        .badge-high { background: var(--dropout-red); color: white; }

        .prediction-card { background: white; border-radius: 15px; padding: 40px; border: 2px solid var(--gray-200); margin-top: 30px; }
        .prediction-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; color: var(--clinical-blue); }
        .dropout-timeline { font-size: 2.5rem; font-weight: 800; color: var(--dropout-red); text-align: center; margin: 30px 0; }
        .costs-breakdown { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-top: 30px; }
        .cost-item { text-align: center; padding: 25px; background: var(--gray-50); border-radius: 12px; }
        
        .cta-button { background: linear-gradient(135deg, var(--retention-green) 0%, #1b5e20 100%); color: white; border: none; padding: 18px 40px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; width: 100%; margin-top: 30px; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .cta-button:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(46, 125, 50, 0.3); }

        /* FOOTER */
        .footer { background: var(--clinical-blue); color: white; padding: 60px 0 40px; margin-top: 80px; text-align: center; }
        
        /* RESPONSIVE */
        @media (max-width: 992px) { .trial-overview { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .input-grid, .costs-breakdown { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="clinical-header">
        <div class="container">
            <div class="header-content">
                <div class="demo-badge">
                    <i class="fas fa-weight"></i> CHRONIC WEIGHT MANAGEMENT ANALYTICS
                </div>
                <h1>TrialForge: Metabolic</h1>
                <p class="header-subtitle">
                    Applying engagement decay modeling to predict patient dropout in long-term weight management and obesity trials.
                </p>
                
                <div class="disclaimer-box">
                    <h4><i class="fas fa-chart-line"></i> The "Plateau Effect" Model</h4>
                    <p>Weight management trials face unique retention risks when weight loss plateaus (typically months 3-6). This dashboard models engagement signal decay specifically during these high-risk windows.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="trial-overview">
            <div class="trial-stat-card">
                <div class="stat-icon enrolled-icon"><i class="fas fa-users"></i></div>
                <div class="stat-value" id="enrolled-patients">240</div>
                <div class="stat-label">Total Enrolled</div>
            </div>
            <div class="trial-stat-card">
                <div class="stat-icon active-icon"><i class="fas fa-walking"></i></div>
                <div class="stat-value" id="active-patients">188</div>
                <div class="stat-label">Active (78%)</div>
            </div>
            <div class="trial-stat-card">
                <div class="stat-icon risk-icon"><i class="fas fa-exclamation-circle"></i></div>
                <div class="stat-value" id="high-risk-patients">32</div>
                <div class="stat-label">"Plateau Risk" (13%)</div>
            </div>
            <div class="trial-stat-card">
                <div class="stat-icon dropout-icon"><i class="fas fa-door-open"></i></div>
                <div class="stat-value" id="dropout-patients">20</div>
                <div class="stat-label">Discontinued</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="input-section">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-user-tag"></i> Patient Profile: Subject 104-B
                    </h2>
                    
                    <div class="patient-section engagement-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon engagement-icon"><i class="fas fa-mobile-alt"></i></div>
                                Digital Engagement Signals
                            </div>
                            <div class="risk-score">
                                <span id="engagement-score">68%</span>
                                <span class="risk-label">Signal Strength</span>
                            </div>
                        </div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">App Login Frequency</label>
                                <select id="appointment-adherence">
                                    <option value="excellent">Daily (>95%)</option>
                                    <option value="good">Weekly (80-95%)</option>
                                    <option value="fair" selected>Irregular (65-80%)</option>
                                    <option value="poor">Rare (<65%)</option>
                                </select>
                                <div class="input-hint">Frequency of patient app interaction</div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Scale/Device Sync</label>
                                <select id="response-time">
                                    <option value="rapid">Auto-Sync (Daily)</option>
                                    <option value="prompt" selected>Manual (Weekly)</option>
                                    <option value="delayed">Sporadic (Bi-weekly)</option>
                                    <option value="poor">Disconnected</option>
                                </select>
                                <div class="input-hint">Data transmission from connected devices</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-section protocol-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon protocol-icon"><i class="fas fa-prescription-bottle"></i></div>
                                Protocol Adherence
                            </div>
                            <div class="risk-score">
                                <span id="protocol-score">72%</span>
                                <span class="risk-label">Adherence Score</span>
                            </div>
                        </div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">Injection/Med Compliance</label>
                                <select id="medication-adherence">
                                    <option value="excellent">100% Verified</option>
                                    <option value="good" selected>Missed 1 dose</option>
                                    <option value="fair">Missed >2 doses</option>
                                    <option value="poor">Treatment Pause</option>
                                </select>
                                <div class="input-hint">Critical for GLP-1 efficacy data</div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Dietary/Caloric Logging</label>
                                <select id="symptom-logging">
                                    <option value="complete">Complete Logs</option>
                                    <option value="partial" selected>Partial Logs</option>
                                    <option value="minimal">Minimal Entry</option>
                                    <option value="none">No Logs</option>
                                </select>
                                <div class="input-hint">High-burden task; key dropout indicator</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-section demographic-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon demographic-icon"><i class="fas fa-weight-hanging"></i></div>
                                Biological Factors
                            </div>
                            <div class="risk-score">
                                <span id="demographic-risk">Medium</span>
                                <span class="risk-label">Loss Velocity</span>
                            </div>
                        </div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">Current Weight Trend</label>
                                <select id="travel-distance">
                                    <option value="local">Rapid Loss (>1kg/wk)</option>
                                    <option value="regional" selected>Steady Loss (0.5kg/wk)</option>
                                    <option value="distant">Plateau (No change)</option>
                                    <option value="remote">Regain (+Weight)</option>
                                </select>
                                <div class="input-hint">Weight stagnation is #1 dropout cause</div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Adverse Events (Nausea)</label>
                                <select id="trial-experience">
                                    <option value="experienced">None</option>
                                    <option value="novice" selected>Mild/Transient</option>
                                    <option value="naive">Moderate/Persistent</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-hand-holding-medical"></i> Targeted "Interaction Maintenance"
                    </h2>
                    <p style="margin-bottom: 25px; color: var(--gray-700);">
                        Select engagement boosters to counteract the "Plateau Effect" decay:
                    </p>
                    
                    <div class="interventions-grid">
                        <div class="intervention-card" data-intervention="transport-support">
                            <div class="intervention-check"><i class="fas fa-check"></i></div>
                            <div class="intervention-title">Smart Scale + Auto-Sync</div>
                            <div class="intervention-description">
                                Provision of cellular-connected scale to remove manual logging friction.
                            </div>
                            <div class="intervention-impact">
                                <div><div class="impact-label">Retention Boost</div><div class="impact-value">+18%</div></div>
                                <div><div class="impact-label">Cost</div><div class="impact-value cost-value">Low</div></div>
                            </div>
                        </div>
                        
                        <div class="intervention-card" data-intervention="digital-engagement">
                            <div class="intervention-check"><i class="fas fa-check"></i></div>
                            <div class="intervention-title">Gamified Milestone App</div>
                            <div class="intervention-description">
                                Unlockable content rewards for hitting logging streaks (non-monetary).
                            </div>
                            <div class="intervention-impact">
                                <div><div class="impact-label">Retention Boost</div><div class="impact-value">+12%</div></div>
                                <div><div class="impact-label">Cost</div><div class="impact-value cost-value">Low</div></div>
                            </div>
                        </div>
                        
                        <div class="intervention-card" data-intervention="care-coordination">
                            <div class="intervention-check"><i class="fas fa-check"></i></div>
                            <div class="intervention-title">Virtual Dietitian Consult</div>
                            <div class="intervention-description">
                                On-demand video chat when weight loss plateaus to adjust protocol.
                            </div>
                            <div class="intervention-impact">
                                <div><div class="impact-label">Retention Boost</div><div class="impact-value">+25%</div></div>
                                <div><div class="impact-label">Cost</div><div class="impact-value cost-value">High</div></div>
                            </div>
                        </div>
                        
                        <div class="intervention-card" data-intervention="flexible-scheduling">
                            <div class="intervention-check"><i class="fas fa-check"></i></div>
                            <div class="intervention-title">Peer Support Group</div>
                            <div class="intervention-description">
                                Opt-in moderated community for patients in the same trial arm.
                            </div>
                            <div class="intervention-impact">
                                <div><div class="impact-label">Retention Boost</div><div class="impact-value">+15%</div></div>
                                <div><div class="impact-label">Cost</div><div class="impact-value cost-value">Med</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <div class="results-grid">
                    <div class="retention-card">
                        <div class="retention-header">
                            <div>
                                <div class="current-retention" id="retention-probability">76%</div>
                                <div class="retention-label">Predicted 12-Month Retention</div>
                            </div>
                            <div class="target-badge">Goal: >80%</div>
                        </div>
                        
                        <div class="comparison-item">
                            <div class="comparison-label">Current Dropout Risk</div>
                            <div class="comparison-value" id="dropout-risk">Medium</div>
                            <span class="comparison-badge badge-medium" id="risk-badge">Monitor</span>
                        </div>
                        
                        <div class="comparison-item">
                            <div class="comparison-label">vs. Placebo Arm Avg</div>
                            <div class="comparison-value">72%</div>
                            <span class="comparison-badge badge-low" id="vs-site">+4%</span>
                        </div>
                    </div>
                    
                    <div class="prediction-card">
                        <div class="prediction-header">
                            <div class="prediction-title">The "Dropout Cliff" Prediction</div>
                            <div class="prediction-subtitle">
                                Based on current weight logs and app usage, this patient is at risk of dropout in:
                            </div>
                        </div>
                        
                        <div class="dropout-timeline" id="dropout-timeline">
                            6 Weeks
                        </div>
                        <div style="text-align: center; color: var(--gray-700); margin-bottom: 20px;">
                            (Likely correlated with upcoming weight plateau)
                        </div>
                        
                        <div class="costs-breakdown">
                            <div class="cost-item">
                                <div class="cost-value retention-value" id="retention-boost">+22%</div>
                                <div class="cost-label">Impact of Selected Content</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-value financial-value" id="cost-savings">Data</div>
                                <div class="cost-label">Value of Complete Dataset</div>
                            </div>
                        </div>
                        
                        <button class="cta-button" id="generate-alert-btn">
                            <i class="fas fa-paper-plane"></i> Deploy Intervention Content
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-chart-area"></i> Engagement Decay vs. Intervention
            </h2>
            <div id="retention-decay-chart" style="height: 500px;"></div>
            <div class="disclaimer-box" style="margin-top: 20px; border-left-color: var(--clinical-blue);">
                <strong>Forge Theory in Obesity Trials:</strong> The red dashed line shows the natural decay of motivation as weight loss slows (The Plateau). The green line demonstrates how "Interaction Maintenance" (e.g., Nutritionist access) resets the engagement baseline.
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="container">
            <p>© 2025 TrialForge | Chronic Weight Management Module</p>
            <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 10px;">Demonstration Concept for Biopharma Retention Strategy</p>
        </div>
    </footer>

    <script>
        // Modified Logic for Weight Management Context
        const EXAMPLE_FACTORS = {
            engagement: {
                appointment: { 'excellent': 0.9, 'good': 0.8, 'fair': 0.7, 'poor': 0.5 },
                response: { 'rapid': 0.95, 'prompt': 0.85, 'delayed': 0.7, 'poor': 0.6 }
            },
            protocol: {
                medication: { 'excellent': 0.95, 'good': 0.85, 'fair': 0.75, 'poor': 0.6 },
                symptoms: { 'complete': 0.9, 'partial': 0.8, 'minimal': 0.65, 'none': 0.5 }
            },
            demographic: {
                travel: { 'local': 0.95, 'regional': 0.9, 'distant': 0.6, 'remote': 0.5 }, // Weight trend impact
                experience: { 'experienced': 0.9, 'novice': 0.8, 'naive': 0.7 } // AE impact
            }
        };
        
        const EXAMPLE_INTERVENTIONS = {
            'transport-support': { retentionBoost: 0.18 }, // Smart Scale
            'digital-engagement': { retentionBoost: 0.12 }, // Gamification
            'care-coordination': { retentionBoost: 0.25 }, // Dietitian
            'flexible-scheduling': { retentionBoost: 0.15 } // Peer Group
        };
        
        // DOM Elements & Init
        let selectedInterventions = new Set(['transport-support']); // Default selection
        
        document.addEventListener('DOMContentLoaded', () => {
            initInterventions();
            document.querySelectorAll('select').forEach(input => input.addEventListener('change', calculateExampleRetention));
            document.getElementById('generate-alert-btn').addEventListener('click', () => alert("Intervention Deployed: \n1. Notification sent to Patient App\n2. Dietitian alerted for outreach\n3. 'Plateau Motivation' content unlocked."));
            calculateExampleRetention();
        });

        function initInterventions() {
            document.querySelectorAll('.intervention-card').forEach(card => {
                const id = card.getAttribute('data-intervention');
                if(selectedInterventions.has(id)) card.classList.add('selected');
                card.addEventListener('click', () => {
                    card.classList.toggle('selected');
                    selectedInterventions.has(id) ? selectedInterventions.delete(id) : selectedInterventions.add(id);
                    calculateExampleRetention();
                });
            });
        }

        function calculateExampleRetention() {
            // Get values
            const appFreq = document.getElementById('appointment-adherence').value;
            const deviceSync = document.getElementById('response-time').value;
            const injComp = document.getElementById('medication-adherence').value;
            const logComp = document.getElementById('symptom-logging').value;
            const weightTrend = document.getElementById('travel-distance').value;
            
            // Calculate Scores
            const engScore = (EXAMPLE_FACTORS.engagement.appointment[appFreq] * 0.5 + EXAMPLE_FACTORS.engagement.response[deviceSync] * 0.5) * 100;
            const proScore = (EXAMPLE_FACTORS.protocol.medication[injComp] * 0.6 + EXAMPLE_FACTORS.protocol.symptoms[logComp] * 0.4) * 100;
            const bioScore = EXAMPLE_FACTORS.demographic.travel[weightTrend] * 100; // Weight trend is heavily weighted
            
            // Update Text
            document.getElementById('engagement-score').textContent = Math.round(engScore) + '%';
            document.getElementById('protocol-score').textContent = Math.round(proScore) + '%';
            
            // Baseline Probability
            let prob = (engScore * 0.3 + proScore * 0.3 + bioScore * 0.4); 
            
            // Add Interventions
            let boost = 0;
            selectedInterventions.forEach(i => boost += (EXAMPLE_INTERVENTIONS[i].retentionBoost * 100));
            prob = Math.min(98, prob + boost);
            
            // Update UI
            document.getElementById('retention-probability').textContent = Math.round(prob) + '%';
            document.getElementById('retention-boost').textContent = '+' + Math.round(boost) + '%';
            
            // Risk Badge
            const riskLabel = document.getElementById('dropout-risk');
            const badge = document.getElementById('risk-badge');
            if (prob > 85) { riskLabel.textContent = "Low"; badge.className = "comparison-badge badge-low"; badge.textContent = "Stable"; }
            else if (prob > 70) { riskLabel.textContent = "Medium"; badge.className = "comparison-badge badge-medium"; badge.textContent = "Monitor"; }
            else { riskLabel.textContent = "High"; badge.className = "comparison-badge badge-high"; badge.textContent = "Critical"; }
            
            // Timeline
            const timeline = document.getElementById('dropout-timeline');
            if (prob > 80) timeline.textContent = "Stable";
            else if (prob > 60) timeline.textContent = "3-4 Months";
            else timeline.textContent = "4-6 Weeks";
            
            updateChart(prob);
        }

        function updateChart(prob) {
            const months = 12;
            const x = [], yBase = [], yInt = [];
            const k_base = 0.15; // Natural decay
            const k_int = 0.05; // Supported decay
            
            for(let t=0; t<=months; t+=1) {
                x.push('Month ' + t);
                yBase.push(prob * Math.exp(-k_base * t));
                yInt.push(prob * Math.exp(-k_int * t));
            }
            
            Plotly.newPlot('retention-decay-chart', [
                { x: x, y: yBase, name: 'Natural Motivation Decay', line: {color: '#c62828', dash: 'dash'} },
                { x: x, y: yInt, name: 'With Interaction Maintenance', line: {color: '#2e7d32', width: 4} }
            ], {
                margin: {t:20, r:20, l:40, b:40},
                yaxis: {range: [0, 105], title: 'Retention Probability'},
                showlegend: true,
                legend: {orientation: 'h', y: -0.2}
            }, {displayModeBar: false});
        }
    </script>
</body>
</html>
